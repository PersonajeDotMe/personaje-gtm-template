___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Personaje",
  "categories": ["ANALYTICS","PERSONALIZATION","REMARKETING"]
  "brand": {
    "id": "brand_dummy",
    "displayName": "",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Personaje segments your users into 4 audiences for further personality-based marketing.",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "trackingId",
    "displayName": "Personaje tracking id",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Require the necessary APIs
const logToConsole = require('logToConsole');
const injectScript = require('injectScript');
const queryPermission = require('queryPermission');
logToConsole('data', data);

// construct URL
const url = 'https://lib.personaje.me/personaje.js?id=' + data.trackingId;

// If the user chose to log debug output, initialize the logging method
const log = data.debug ? logToConsole : (() => {});

log('Loading script from ' + url);

// If the script loaded successfully, log a message and signal success
const onSuccess = () => {
  log('Script loaded successfully.');
  data.gtmOnSuccess();
};

// If the script fails to load, log a message and signal failure
const onFailure = () => {
  log('Script load failed.');
  data.gtmOnFailure();
};

if (queryPermission('inject_script', url)) {
  injectScript(url, onSuccess, onFailure, url);
} else {
  log('injectScript not allowed!');
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://lib.personaje.me/personaje.js?id\u003d*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Script injection test
  code: |-
    const mockData = {
      // Mocked field values
      trackingId: '123456',
      debug: true
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();
setup: ''


___NOTES___

Created on 3/2/2023, 6:00:22 PM


